<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - MarketPulse Analytics</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <!-- Mobile Responsive CSS -->
    <link rel="stylesheet" href="css/mobile-responsive.css">
    <!-- Accessibility CSS -->
    <link rel="stylesheet" href="css/accessibility.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #f8f9fa;
        }
        
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: white !important;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .admin-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .nav-tabs .nav-link {
            color: #667eea;
            border: none;
            border-bottom: 2px solid transparent;
        }
        
        .nav-tabs .nav-link.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            background: transparent;
        }
        
        .table {
            border-radius: 8px;
            overflow: hidden;
        }
        
        .table thead {
            background: #f8f9fa;
        }
        
        .btn-sm {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
        }
        
        .badge {
            padding: 0.35em 0.65em;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .stats-card h3 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }
        
        .stats-card p {
            margin: 0;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-graph-up-arrow"></i> MarketPulse Admin
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link text-white" href="index.html">Dashboard</a>
                <a class="nav-link text-white" href="profile.html">Profile</a>
                <a class="nav-link text-white active" href="admin.html">Admin</a>
                <button class="btn btn-outline-light btn-sm ms-2" onclick="window.auth.logout()">Logout</button>
            </div>
        </div>
    </nav>
    
    <div class="admin-container">
        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <p>Total Users</p>
                    <h3 id="totalUsers">—</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <p>Active Users</p>
                    <h3 id="activeUsers">—</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <p>Admins</p>
                    <h3 id="totalAdmins">—</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <p>Inactive Users</p>
                    <h3 id="inactiveUsers">—</h3>
                </div>
            </div>
        </div>
        
        <!-- Alerts -->
        <div id="errorAlert" class="alert alert-danger" role="alert" style="display: none;"></div>
        <div id="successAlert" class="alert alert-success" role="alert" style="display: none;"></div>
        
        <!-- Admin Tabs -->
        <div class="admin-card">
            <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">
                        <i class="bi bi-people"></i> User Management
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="admins-tab" data-bs-toggle="tab" data-bs-target="#admins" type="button" role="tab">
                        <i class="bi bi-shield-check"></i> Admin Management
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="companies-tab" data-bs-toggle="tab" data-bs-target="#companies" type="button" role="tab">
                        <i class="bi bi-building"></i> Companies
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="news-tab" data-bs-toggle="tab" data-bs-target="#news" type="button" role="tab">
                        <i class="bi bi-newspaper"></i> News
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="warehouse-tab" data-bs-toggle="tab" data-bs-target="#warehouse" type="button" role="tab">
                        <i class="bi bi-database"></i> Data Warehouse
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="database-tab" data-bs-toggle="tab" data-bs-target="#database" type="button" role="tab">
                        <i class="bi bi-gear"></i> Database
                    </button>
                </li>
            </ul>
            
            <div class="tab-content" id="adminTabContent">
                <!-- Users Tab -->
                <div class="tab-pane fade show active" id="users" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>User Management</h5>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createUserModal">
                            <i class="bi bi-person-plus"></i> Create User
                        </button>
                    </div>
                    
                    <div class="mb-3">
                        <input type="text" class="form-control" id="userSearch" placeholder="Search users...">
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="7" class="text-center">
                                        <div class="text-muted">Loading...</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Admins Tab -->
                <div class="tab-pane fade" id="admins" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Admin Management</h5>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#promoteUserModal">
                            <i class="bi bi-shield-plus"></i> Promote User
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminsTableBody">
                                <tr>
                                    <td colspan="5" class="text-center">
                                        <div class="text-muted">Loading...</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Companies Tab -->
                <div class="tab-pane fade" id="companies" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Company Management</h5>
                        <a href="admin-companies.html" class="btn btn-primary">
                            <i class="bi bi-building-add"></i> Manage Companies
                        </a>
                    </div>
                    <p class="text-muted">Company management interface coming soon. Click the button above to access it.</p>
                </div>
                
                <!-- News Tab -->
                <div class="tab-pane fade" id="news" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>News Management</h5>
                        <a href="admin-news.html" class="btn btn-primary">
                            <i class="bi bi-newspaper"></i> Manage News
                        </a>
                    </div>
                    <p class="text-muted">News management interface coming soon. Click the button above to access it.</p>
                </div>
                
                <!-- Data Warehouse Tab -->
                <div class="tab-pane fade" id="warehouse" role="tabpanel">
                    <h5 class="mb-4">Data Warehouse Management</h5>
                    
                    <!-- ETL Pipeline Status -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">ETL Pipeline Status</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <strong>Status:</strong> 
                                <span id="etlStatus" class="badge bg-secondary ms-2">Loading...</span>
                            </div>
                            <div class="mb-3">
                                <strong>Last Run:</strong> 
                                <span id="etlLastRun" class="ms-2">-</span>
                            </div>
                            <div class="mb-3">
                                <strong>Records Processed:</strong> 
                                <span id="etlRecords" class="ms-2">-</span>
                            </div>
                            <button onclick="runETLPipeline()" class="btn btn-primary">
                                <i class="bi bi-play-circle"></i> Run ETL Pipeline
                            </button>
                        </div>
                    </div>
                    
                    <!-- Materialized Views - Hidden (admin-only technical tool) -->
                    
                    <!-- OLAP Analysis -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">OLAP Analysis</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Analysis Type:</label>
                                <select id="olapAnalysisType" class="form-select">
                                    <option value="sector-time">Sector & Time Analysis</option>
                                    <option value="trend">Trend Analysis</option>
                                </select>
                            </div>
                            <button onclick="loadOLAPAnalysis()" class="btn btn-info">
                                <i class="bi bi-graph-up"></i> Run Analysis
                            </button>
                            <div id="olapResults" class="mt-3"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Database Performance Tab -->
                <div class="tab-pane fade" id="database" role="tabpanel">
                    <h5 class="mb-4">Database Performance & Maintenance</h5>
                    
                    <!-- Transaction Isolation Level -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">Transaction Isolation Level</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <strong>Current Level:</strong>
                                <span id="currentIsolationLevel" class="badge bg-info ms-2">Loading...</span>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Set Isolation Level:</label>
                                <select id="isolationLevelSelect" class="form-select">
                                    <option value="READ_UNCOMMITTED">READ UNCOMMITTED (Lowest isolation)</option>
                                    <option value="READ_COMMITTED" selected>READ COMMITTED (Default)</option>
                                    <option value="REPEATABLE_READ">REPEATABLE READ (Higher consistency)</option>
                                    <option value="SERIALIZABLE">SERIALIZABLE (Highest isolation)</option>
                                </select>
                                <small class="text-muted">Note: Changes apply to new transactions only</small>
                            </div>
                            <button onclick="setIsolationLevel()" class="btn btn-primary">Set Isolation Level</button>
                            <div id="isolationLevelInfo" class="alert alert-info mt-3 mb-0">
                                <strong>READ COMMITTED:</strong> Default level. Prevents dirty reads but allows non-repeatable reads.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Query Performance Analyzer - Hidden (admin-only technical tool) -->
                    
                    <!-- Table Maintenance -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">Table Maintenance</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <h6>Table Sizes</h6>
                                <button onclick="loadTableSizes()" class="btn btn-sm btn-outline-primary">Refresh Table Sizes</button>
                                <div id="tableSizesContainer" class="mt-3"></div>
                            </div>
                            
                            <div class="mb-3">
                                <h6>Analyze Table</h6>
                                <select id="tableToAnalyze" class="form-select d-inline-block" style="width: 200px;">
                                    <option value="">Select table...</option>
                                    <option value="companies">companies</option>
                                    <option value="stock_prices">stock_prices</option>
                                    <option value="users">users</option>
                                </select>
                                <button onclick="analyzeTable()" class="btn btn-sm btn-primary ms-2">Analyze</button>
                            </div>
                            
                            <div class="mb-3">
                                <h6>Optimize Table</h6>
                                <select id="tableToOptimize" class="form-select d-inline-block" style="width: 200px;">
                                    <option value="">Select table...</option>
                                    <option value="companies">companies</option>
                                    <option value="stock_prices">stock_prices</option>
                                    <option value="users">users</option>
                                </select>
                                <button onclick="optimizeTable()" class="btn btn-sm btn-warning ms-2">Optimize</button>
                                <small class="text-muted d-block mt-1">Note: Optimization may take several minutes for large tables</small>
                            </div>
                            
                            <div>
                                <h6>Bulk Operations</h6>
                                <button onclick="analyzeAllTables()" class="btn btn-sm btn-outline-primary">Analyze All Tables</button>
                                <button onclick="optimizeAllTables()" class="btn btn-sm btn-outline-warning">Optimize All Tables</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create User Modal -->
    <div class="modal fade" id="createUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createUserForm">
                        <div class="mb-3">
                            <label for="newUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="newUsername" required minlength="3" maxlength="20">
                        </div>
                        <div class="mb-3">
                            <label for="newEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="newEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="newPassword" required minlength="8">
                        </div>
                        <div class="mb-3">
                            <label for="newRole" class="form-label">Role</label>
                            <select class="form-select" id="newRole" required>
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createUser()">Create User</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Promote User Modal -->
    <div class="modal fade" id="promoteUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Promote User to Admin</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="promoteUserForm">
                        <div class="mb-3">
                            <label for="promoteUserId" class="form-label">Select User</label>
                            <select class="form-select" id="promoteUserId" required>
                                <option value="">Loading users...</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="promoteUser()">Promote to Admin</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script>
        window.API_BASE = 'http://localhost:8080/api';
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Utility Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/error-handler.js"></script>
    <script src="js/loading-states.js"></script>
    
    <!-- Mobile & Accessibility Scripts -->
    <script src="js/mobile-responsive.js"></script>
    <script src="js/accessibility.js"></script>
    
    <!-- API & Auth Scripts -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>

